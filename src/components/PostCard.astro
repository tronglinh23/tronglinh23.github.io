---
import TagPill from '@/components/TagPill.astro';
import { formatDate } from '@/lib/utils';

const { entry, href } = Astro.props;
const data = entry.data;

// Normalize tags for display.
const tags = (data.tags ?? [])
  .map((t) => (typeof t === 'string' ? t.trim() : ''))
  .filter((t) => t.length > 0);
---

<a
  href={href}
  class="group block rounded-3xl border border-white/10 bg-white/5 p-5 shadow-glass transition hover:border-white/20 hover:bg-white/10"
>
  <div class="flex items-start justify-between gap-4">
    <div>
      <div class="text-sm text-white/55">
        {formatDate(data.date)}{data.updated ? ` · updated ${formatDate(data.updated)}` : ''}
      </div>
      <h3 class="mt-2 text-lg font-semibold text-white/90 group-hover:text-white">{data.title}</h3>
      <p class="mt-2 line-clamp-2 text-sm text-white/70">{data.description}</p>
    </div>
    <div
      class="hidden h-10 w-10 items-center justify-center rounded-2xl border border-white/10 bg-black/20 text-white/70 md:flex"
    >
      ↗
    </div>
  </div>

  {
    tags.length > 0 && (
      <div class="mt-4 flex flex-wrap gap-2">
        {tags.slice(0, 5).map((t) => (
          <TagPill tag={t} link={false} />
        ))}
      </div>
    )
  }

  <div class="mt-4 flex flex-wrap gap-2 text-xs text-white/55">
    {
      data.ctf_event && (
        <span class="rounded-full border border-white/10 bg-black/20 px-3 py-1">
          {data.ctf_event}
        </span>
      )
    }
    {
      data.category && (
        <span class="rounded-full border border-white/10 bg-black/20 px-3 py-1">
          {data.category}
        </span>
      )
    }
    {
      data.difficulty && (
        <span class="rounded-full border border-white/10 bg-black/20 px-3 py-1">
          {data.difficulty}
        </span>
      )
    }
  </div>
</a>
