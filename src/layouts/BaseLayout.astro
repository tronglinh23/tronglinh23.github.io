---
import '@/styles/global.css';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import ReadingProgress from '@/components/ReadingProgress.astro';
import { basePath } from '@/lib/base';

const { title, description, noProgress } = Astro.props;
const pageTitle = title ? `${title} • Logbook` : 'Logbook';
const pageDesc =
  description ??
  'Writeups, research notes, and curated links about web security, exploitation, and CTF problem-solving.';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>
    <meta name="description" content={pageDesc} />

    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDesc} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content={`${Astro.site}/og-default.png`} />

    <link rel="icon" href={`${basePath}/favicon.svg`} />
  </head>
  <body class="min-h-screen flex flex-col">
    <div class="cosmic-system" aria-hidden="true">
      <span class="sun"></span>
      <span class="planet mercury"></span>
      <span class="planet venus"></span>
      <span class="planet earth"></span>
      <span class="planet mars"></span>
      <span class="planet jupiter"></span>
      <span class="planet saturn"></span>
      <span class="planet uranus"></span>
      <span class="planet neptune"></span>
      <span class="asteroid a1"></span>
      <span class="asteroid a2"></span>
      <span class="asteroid a3"></span>
    </div>
    {!noProgress && <ReadingProgress />}
    <Header />
    <main class="mx-auto w-full max-w-6xl px-4 pb-20 pt-8 flex-1">
      <slot />
    </main>

    <Footer />

    <script>
      // Add copy buttons to code blocks (client-side).
      (function () {
        const pres = document.querySelectorAll('pre');
        pres.forEach((pre) => {
          const code = pre.querySelector('code');
          if (!code) return;
          pre.style.position = 'relative';

          const btn = document.createElement('button');
          btn.className = 'code-copy-btn';
          btn.type = 'button';
          btn.textContent = 'Copy';

          btn.addEventListener('click', async () => {
            try {
              await navigator.clipboard.writeText(code.textContent || '');
              btn.textContent = 'Copied ✓';
              setTimeout(() => (btn.textContent = 'Copy'), 900);
            } catch (e) {
              btn.textContent = 'Failed';
              setTimeout(() => (btn.textContent = 'Copy'), 900);
            }
          });

          pre.appendChild(btn);
        });
      })();
    </script>
  </body>
</html>
