---
import BaseLayout from '@/layouts/BaseLayout.astro';
import SearchAndFilters from '@/components/SearchAndFilters.astro';
import PostCard from '@/components/PostCard.astro';
import { basePath } from '@/lib/base';
import { buildSearchItems, getBlogPosts } from '@/lib/collections';

const posts = await getBlogPosts();

const pageSize = 10;
const totalPages = Math.max(1, Math.ceil(posts.length / pageSize));
const pagePosts = posts.slice(0, pageSize);

const items = buildSearchItems(pagePosts, basePath);
---

<BaseLayout title="Blog" description="CTF writeups, research notes, and longer-form posts.">
  <div class="mb-6">
    <h1 class="text-3xl font-semibold text-white/95">Blog</h1>
    <p class="mt-2 text-white/70">CTF writeups, research notes, and deep dives.</p>
  </div>

  <SearchAndFilters items={items} />

  <div id="results" class="mt-6 grid gap-4">
    {pagePosts.map((p) => <PostCard entry={p} href={`${basePath}/blog/${p.slug}`} />)}
  </div>

  {
    totalPages > 1 && (
      <nav class="mt-8 flex items-center justify-between text-sm text-white/70">
        <span>Page 1 of {totalPages}</span>
        <a
          class="rounded-2xl border border-white/10 bg-black/20 px-3 py-2 text-white/75 hover:bg-white/10 hover:text-white"
          href={`${basePath}/blog/2`}
        >
          Next â†’
        </a>
      </nav>
    )
  }
</BaseLayout>
