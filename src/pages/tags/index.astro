---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { basePath } from '@/lib/base';

const collections = ['blog', 'links'] as const;
const all = (await Promise.all(collections.map((c) => getCollection(c)))).flat().filter((p) => !p.data.draft);

const counts = new Map<string, number>();
for (const p of all) {
  for (const t of p.data.tags ?? []) counts.set(t, (counts.get(t) ?? 0) + 1);
}
const tags = [...counts.entries()].sort((a,b)=>b[1]-a[1]);
---

<BaseLayout title="Tags" description="Browse tags across posts and research links.">
  <h1 class="text-3xl font-semibold text-white/95">Tags</h1>
  <p class="mt-2 text-white/70">Browse all tags across posts and research links.</p>

  <div class="mt-6 glass rounded-3xl p-5">
    <div class="flex flex-wrap gap-2">
      {tags.map(([t, n]) => (
        <a
          class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-white/75 hover:bg-white/10 hover:text-white"
          href={`${basePath}/tags/${t.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,'')}`}
        >
          <span>#{t}</span>
          <span class="rounded-full bg-black/25 px-2 py-0.5 text-white/60">{n}</span>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
