---
title: untitled-smarty-challenge
description: ''
tags:
  - writeup
  - ssti
  - rce
  - file-upload
  - command-injection
  - path-traversal
category: web
draft: false
date: 2023-07-04
---

import Callout from '@/components/mdx/Callout.astro';

Status: Not started

## Summary

<Callout type="note" title="Note">
üí° SSTI in Smarty via cached templates and Symfony Process.

</Callout>

## Description

## Analyst

- M·ªói khi ta g·ª≠i l√™n server m·ªôt param `pages` t·ªìn t·∫°i th√¨ ph√≠a server s·∫Ω t·∫°o ra 1 file trong `templates_c` bao g·ªìm c·∫£ param `pages` ta truy·ªÅn.

  ![image.png](/uploads/untitled-smarty-challenge/untitled-smarty-challenge/image.png)

- T·ª´ ƒë√≥ √Ω t∆∞·ªüng l√† truy·ªÅn v√†o payload SSTI m√† v·∫´n ƒë∆∞·ª£c path valid:

```python
{7*7}/../home
```

- Gi·ªù ta ƒë√£ c√≥ th·ªÉ SSTI. Tuy nhi√™n b√†i n√†y d√πng Smarty 5 n√™n kh√¥ng c√≤n `system`. Ngo√†i ra t√°c gi·∫£ require c·∫£ Symfony (ban ƒë·∫ßu ch∆∞a r√µ d√πng ƒë·ªÉ l√†m g√¨).

![image.png](/uploads/untitled-smarty-challenge/untitled-smarty-challenge/image-1.png)

- Do ƒë√≥ ta c√≥ th·ªÉ d√πng Symfony ƒë·ªÉ SSTI.
- ƒê·ªçc doc c·ªßa Symfony Process: https://symfony.com/doc/current/components/process.html
- Ta c√≥ th·ªÉ SSTI v·ªõi command nh∆∞ sau:

```python
{Symfony\Component\Process\Process::fromShellCommandline("cat /flag* > x0n1l.txt")->run()}
```

- Add v√†o path th√¨ kh√¥ng ƒë∆∞·ª£c do slash. Tuy nhi√™n n·∫øu ƒë·ªçc ph·∫ßn template c·ªßa Smarty 5 ta c√≥ th·ªÉ g·ªçi th√¥ng qua include file: https://smarty-php.github.io/smarty/stable/api/resources/#templates-from-a-specific-directory
- T·ª´ ƒë√≥ payload:

```python
{include file="eval:base64:e1N5bWZvbnlcQ29tcG9uZW50XFByb2Nlc3NcUHJvY2Vzczo6ZnJvbVNoZWxsQ29tbWFuZGxpbmUoImNhdCAvZmxhZyogPiB4MG4xbC50eHQiKS0%2BcnVuKCl9"}
```

- Th√†nh c√¥ng ghi flag ra file v√† l·∫•y flag.

![image.png](/uploads/untitled-smarty-challenge/untitled-smarty-challenge/image-2.png)

## Exploit

## Result
